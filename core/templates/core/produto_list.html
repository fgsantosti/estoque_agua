
{% extends 'base.html' %}

{% block title %}Produtos{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-box me-2"></i>Produtos</h2>
    <a href="{% url 'produto_create' %}" class="btn btn-primary">
        <i class="fas fa-plus me-2"></i>Novo Produto
    </a>
</div>

<div class="card mb-4">
    <div class="card-body">
        <form method="get" class="row g-3">
            <div class="col-md-4">
                <input type="text" name="search" value="{{ search }}" class="form-control" 
                       placeholder="Buscar por nome ou código">
            </div>
            <div class="col-md-4">
                <select name="categoria" class="form-select">
                    <option value="">Todas as categorias</option>
                    {% for cat in categorias %}
                        <option value="{{ cat.id }}" {% if categoria_id|default:'' == cat.id|stringformat:'s' %}selected{% endif %}>
                            {{ cat.nome }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-outline-primary">
                    <i class="fas fa-search me-2"></i>Filtrar
                </button>
            </div>
        </form>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead class="table-light">
                    <tr>
                        <th><i class="fas fa-box me-1"></i>Nome</th>
                        <th class="d-none d-md-table-cell"><i class="fas fa-barcode me-1"></i>Código</th>
                        <th class="d-none d-md-table-cell"><i class="fas fa-tags me-1"></i>Categoria</th>
                        <th><i class="fas fa-cubes me-1"></i>Estoque</th>
                        <th class="d-none d-md-table-cell"><i class="fas fa-dollar-sign me-1"></i>Preço Venda</th>
      <th>Ações</th>
    </tr>
  </thead>
  <tbody>
    {% for produto in page_obj %}
    <tr {% if produto.estoque_baixo %}class="table-danger"{% endif %}>
      <td>{{ produto.nome }}</td>
      <td class="d-none d-md-table-cell">{{ produto.codigo }}</td>
      <td class="d-none d-md-table-cell">{{ produto.categoria.nome }}</td>
      <td>{{ produto.estoque_atual }}</td>
      <td class="d-none d-md-table-cell">R$ {{ produto.preco_venda|floatformat:2 }}</td>
      <td>
        <a href="{% url 'produto_edit' produto.pk %}" class="btn btn-sm btn-primary">Editar</a>
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="6">Nenhum produto encontrado.</td></tr>
    {% endfor %}
  </tbody>
</table>
<nav>
  <ul class="pagination">
    {% if page_obj.has_previous %}
      <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Anterior</a></li>
    {% endif %}
    <li class="page-item active"><span class="page-link">{{ page_obj.number }}</span></li>
    {% if page_obj.has_next %}
      <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Próxima</a></li>
    {% endif %}
  </ul>
</nav>
{% endblock %}

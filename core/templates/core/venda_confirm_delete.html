{% extends 'base.html' %}
{% block title %}{{ title }}{% endblock %}
{% block content %}
<div class="container py-4">
  <div class="card">
    <div class="card-body">
      <h4 class="mb-3">{{ title }}</h4>
      
      <div class="alert alert-info mb-4">
        <h5><i class="fas fa-info-circle me-2"></i>Detalhes da Venda</h5>
        <p class="mb-2"><strong>Número:</strong> {{ object.numero_venda }}</p>
        <p class="mb-2"><strong>Data:</strong> {{ object.data_venda|date:"d/m/Y H:i" }}</p>
        <p class="mb-2"><strong>Cliente:</strong> 
          {% if object.cliente %}
            {{ object.cliente.nome }}
          {% else %}
            <em>Cliente não informado</em>
          {% endif %}
        </p>
        <p class="mb-2"><strong>Total de Itens:</strong> {{ items_count }}</p>
        <p class="mb-2"><strong>Valor Total:</strong> R$ {{ valor_total|floatformat:2 }}</p>
        <p class="mb-0"><strong>Status:</strong> 
          <span class="badge bg-{% if object.status == 'finalizada' %}success{% elif object.status == 'aberta' %}warning{% else %}danger{% endif %}">
            {{ object.get_status_display }}
          </span>
        </p>
      </div>
      
      {% if delete_message %}
      <div class="alert alert-warning">
        <i class="fas fa-exclamation-triangle me-2"></i>
        {{ delete_message }}
      </div>
      {% endif %}
      
      {% if object.status == 'finalizada' %}
      <div class="alert alert-danger">
        <h6><i class="fas fa-ban me-2"></i>Atenção - Cancelamento de Venda Finalizada</h6>
        <p class="mb-2">Esta ação irá:</p>
        <ul class="mb-0">
          <li>Cancelar a venda definitivamente</li>
          <li>Restaurar o estoque de todos os produtos</li>
          <li>Remover as movimentações de saída relacionadas</li>
          <li><strong>Esta ação não pode ser desfeita</strong></li>
        </ul>
      </div>
      {% else %}
      <div class="alert alert-danger">
        <h6><i class="fas fa-trash me-2"></i>Exclusão de Venda</h6>
        <p class="mb-0">
          A venda será deletada permanentemente do sistema.
          <strong>Esta ação não pode ser desfeita.</strong>
        </p>
      </div>
      {% endif %}
      
      <form method="post">
        {% csrf_token %}
        <div class="text-end">
          <a href="{% url cancel_url %}" class="btn btn-secondary me-2">
            <i class="fas fa-arrow-left me-2"></i>Cancelar
          </a>
          <button type="submit" class="btn btn-danger">
            {% if object.status == 'finalizada' %}
              <i class="fas fa-ban me-2"></i>Confirmar Cancelamento
            {% else %}
              <i class="fas fa-trash me-2"></i>Confirmar Exclusão
            {% endif %}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

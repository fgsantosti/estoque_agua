
{% extends 'base.html' %}
{% block title %}Movimentações{% endblock %}
{% block content %}
<h2>Movimentações de Estoque</h2>
<a href="{% url 'movimentacao_create' %}" class="btn btn-success mb-3">Nova Movimentação</a>
<form method="get" class="row g-2 mb-3">
  <div class="col-md-3">
    <select name="tipo" class="form-select">
      <option value="">Todos os tipos</option>
      <option value="entrada" {% if tipo == 'entrada' %}selected{% endif %}>Entrada</option>
      <option value="saida" {% if tipo == 'saida' %}selected{% endif %}>Saída</option>
      <option value="ajuste" {% if tipo == 'ajuste' %}selected{% endif %}>Ajuste</option>
    </select>
  </div>
  <div class="col-md-3">
    <select name="produto" class="form-select">
      <option value="">Todos os produtos</option>
      {% for p in produtos %}
        <option value="{{ p.id }}" {% if produto_id|default:'' == p.id|stringformat:'s' %}selected{% endif %}>{{ p.nome }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <input type="date" name="data_inicio" value="{{ data_inicio }}" class="form-control" placeholder="Data início">
  </div>
  <div class="col-md-2">
    <input type="date" name="data_fim" value="{{ data_fim }}" class="form-control" placeholder="Data fim">
  </div>
  <div class="col-md-2">
    <button type="submit" class="btn btn-primary">Filtrar</button>
  </div>
</form>
<table class="table table-striped">
  <thead>
    <tr>
      <th>Data</th>
      <th>Produto</th>
      <th>Tipo</th>
      <th>Quantidade</th>
      <th>Usuário</th>
    </tr>
  </thead>
  <tbody>
    {% for mov in page_obj %}
    <tr>
      <td>{{ mov.data_movimentacao|date:'d/m/Y H:i' }}</td>
      <td>{{ mov.produto.nome }}</td>
      <td>{{ mov.get_tipo_display }}</td>
      <td>{{ mov.quantidade }}</td>
      <td>{{ mov.usuario.username }}</td>
    </tr>
    {% empty %}
    <tr><td colspan="5">Nenhuma movimentação encontrada.</td></tr>
    {% endfor %}
  </tbody>
</table>
<nav>
  <ul class="pagination">
    {% if page_obj.has_previous %}
      <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Anterior</a></li>
    {% endif %}
    <li class="page-item active"><span class="page-link">{{ page_obj.number }}</span></li>
    {% if page_obj.has_next %}
      <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Próxima</a></li>
    {% endif %}
  </ul>
</nav>
{% endblock %}
